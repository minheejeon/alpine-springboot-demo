<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Spring boot + Alpine.js Demo</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        input {
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 300px;
            box-sizing: border-box;
        }

        .completed {
            text-decoration: line-through;
            color: gray;
        }

        li {
            margin-bottom: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div x-data="{
            todos: [],
            newText: '',
            keyword: '',

            // 1. ì„œë²„ì—ì„œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (GET)
            loadTodos() {
                fetch('/api/todos')
                    .then(response => response.json())
                    .then(data => {
                        this.todos = data;
                        console.log('ë°ì´í„° ë¡œë”© ì™„ë£Œ: ', data);
                    });
            },

            // 2. ì„œë²„ì— í•  ì¼ ì €ì¥í•˜ê¸° (POST)
            addTodo() {
                if (this.newText.trim() === '') return;

                fetch('/api/todos', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: this.newText, done: false })
                })
                .then(response => response.json())
                .then(updateList => {
                this.todos = updateList;
                this.newText = '';
                });
            },
            deleteTodo(todoText) {
                fetch('/api/todos/' + todoText, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(updateList => {
                    this.todos = updateList;
                });
            },
            get filteredTodos() {
                if (this.keyword === '') {
                    return this.todos;
                }

                return this.todos.filter(todo => todo.text.includes(this.keyword));
            }
        }" x-init="loadTodos()">

        <h1>Alpine.js + Fetch API ì‹¤ìŠµ</h1>

        <div style="margin-bottom: 20px; background: #eee; padding: 10px; border-radius: 5px;">
            <span>ğŸ” ê²€ìƒ‰: </span>
            <input type="text" x-model="keyword" placeholder="í•  ì¼ ê²€ìƒ‰ . . .">
        </div>
        <div>
            <input type="text" x-model="newText" @keydown.enter="addTodo()" placeholder="í•  ì¼ ì…ë ¥ í›„ ì—”í„°">
            <button @click="addTodo()">ì¶”ê°€</button>
        </div>
        <hr>
        <ul>
            <template x-for="(todo, index) in filteredTodos" :key="index">
                <li>
                    <span x-text="todo.done ? 'âœ…' : 'â¬œ'" style="cursor: pointer;" @click="todo.done = !todo.done"></span>
                    <span x-text="todo.text" :class="todo.done ? 'completed' : ''"></span>

                    <button @click.stop="deleteTodo(todo.text)" style="background: red; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                        ì‚­ì œ
                    </button>
                </li>
            </template>
        </ul>
        <div x-show="filteredTodos.length === 0 && todos.length > 0">
            ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸ˜¢
        </div>
    </div>

</body>
</html>